<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Surprise â€” Bon anniversaire Maman !</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#070607;
    --txt:#ffffff;
    --accent:#f5c246;
  }
  html,body{height:100%;margin:0;font-family: 'Roboto', Arial, sans-serif;background:var(--bg);color:var(--txt);} 
  .stage{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
    position:relative;
    overflow:hidden;
  }
  .panel{
    text-align:center;
    max-width:1100px;
    width:100%;
    padding:40px;
  }
  .line{
    font-size: clamp(20px, 4.2vw, 48px);
    font-weight:700;
    color:var(--txt);
    margin:24px 0;
    opacity:0;
    transition:opacity .25s ease;
    text-shadow: 0 6px 22px rgba(0,0,0,0.6);
    font-family: 'Playfair Display', serif;
  }
  .line.show{ opacity:1; }
  .sub{
    font-weight:400;
    font-size: clamp(14px, 2vw, 18px);
    margin-top:8px;
  }
  /* image container */
  .img-wrap{
    position:relative;
    margin: 10px auto;
    max-width:500px;
    width:100%;
    height:auto;
    display:none;
  }
  .img-wrap img{
    max-width:100%;
    height:auto;
    border-radius:8px;
    box-shadow:0 10px 40px rgba(0,0,0,0.6);
  }

  /* final reveal */
  .reveal-overlay{
    position:absolute;
    inset:0;
    background: radial-gradient(circle at center, rgba(255,255,255,0) 0%, rgba(0,0,0,0.6) 40%, rgba(0,0,0,0.9) 100%);
    pointer-events:none;
    transition:opacity .6s ease;
  }
  .explosion {
    position:relative;
    margin-top:20px;
    display:none;
    align-items:center;
    justify-content:center;
    opacity:0;
    transition:opacity .6s ease;
  }
  .explosion.show{ display:flex; opacity:1; }
  .final-images{
    display:flex;
    gap:30px;
    align-items:center;
    justify-content:center;
    transform:translateY(0);
  }
  .final-images img{ max-width:40vw; width:260px; border-radius:8px; box-shadow:0 14px 40px rgba(0,0,0,0.6); }

  /* small note */
  .note{ position:absolute; left:12px; bottom:10px; font-size:12px; color:rgba(255,255,255,0.25); }

  /* responsive */
  @media (max-width:720px){
    .final-images img{ width:42vw; max-width:180px; }
    .line{ margin:18px 0; }
  }
</style>
</head>
<body>
  <div class="stage" id="stage">
    <div class="panel" role="main" aria-live="polite">
      <div id="linesWrapper">
        <!-- Lines will be injected by JS -->
      </div>

      <!-- image for line 2 (jesus) -->
      <div class="img-wrap" id="jesusWrap" aria-hidden="true">
        <img id="jesusImg" src="https://cdn-useast1.kapwing.com/static/templates/buddy-christ-meme-template-thumbnail-b83659f8.webp" alt="Image spirituelle" loading="lazy" />
      </div>

      <!-- final explosion area -->
      <div class="explosion" id="explosion" aria-hidden="true">
        <div class="final-images" id="finalImages">
          <img id="knightImg" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT7UHe4EmUI1M73baN2mDOx-grtG4ORUvZqmA&s" alt="Image finale 1" loading="lazy" />
          <img id="eggImg" src="https://crack-the-egg.com/wp-content/uploads/oeuf_noir_600x600.jpg" alt="Image finale 2" loading="lazy" />
        </div>
      </div>

      <div class="note">Scannez, regardez et profitez ðŸŽ‰</div>
    </div>

    <div class="reveal-overlay" id="overlay"></div>
  </div>

  <!-- confetti lib -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

  <script>
  const lines = [
    { text: "BON ANNIVERSAIRE MAMAN", sound: "https://www.soundjay.com/human/applause-8.mp3", showJesus:false, final:false },
    { text: "DÃ©jÃ  un demi siÃ¨cle que tu illumines cette Terre par ta prÃ©sence !!", sound: "https://www.soundjay.com/misc/sparkle-02.mp3", showJesus:true, final:false },
    { text: "Et pour te remercier de cela", sound: "https://www.soundjay.com/human/cheer-1.mp3", showJesus:false, final:false },
    { text: "Toute la famille s'est organisÃ©e pour t'offrir", sound: "https://www.soundjay.com/misc/drum-roll-01.mp3", showJesus:false, final:false },
    { text: "pour t'offrir...", sound: "https://www.soundjay.com/misc/drum-roll-02.mp3", showJesus:false, final:false },
    { text: "POUR T'OFFRIR........", sound: "https://www.soundjay.com/misc/drum-roll-03.mp3", showJesus:false, final:false },
    { text: "Je laisse durer encore un peu le suspens", sound: null, showJesus:false, final:false },
    { text: "UNE SORTIE ESCAPE GAME AVEC TOUTE LA FAMILLE ðŸ¥³ðŸ¥³ðŸ¥³", sound: "https://www.soundjay.com/human/applause-8.mp3", showJesus:false, final:true }
  ];

  const wrapper = document.getElementById('linesWrapper');
  lines.forEach((l, idx) => {
    const div = document.createElement('div');
    div.className = 'line';
    div.id = 'line-'+idx;
    div.textContent = l.text;
    wrapper.appendChild(div);
  });

  const jesusWrap = document.getElementById('jesusWrap');
  const explosion = document.getElementById('explosion');
  const overlay = document.getElementById('overlay');

  function playSound(url){
    if(!url) return;
    try{
      const a = new Audio(url);
      a.volume = 0.9;
      a.play().catch(e => console.warn('Sound play blocked', e));
    }catch(e){ console.warn(e); }
  }

  function speak(text, onend){
    const u = new SpeechSynthesisUtterance(text);
    const voices = window.speechSynthesis.getVoices();
    const frVoices = voices.filter(v => /fr|french|fr-FR/i.test(v.lang + ' ' + v.name));
    if(frVoices.length) { u.voice = frVoices[0]; } else if(voices.length) { u.voice = voices[0]; }
    u.rate = 0.95; u.pitch = 1.05; u.volume = 1.0;
    u.onend = onend;
    try {
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(u);
    } catch(e){ if(onend) setTimeout(onend, 1200 + text.length*12); }
  }

  let idx = 0;
  function showLine(i){
    const line = document.getElementById('line-'+i);
    document.querySelectorAll('.line').forEach(el => el.classList.remove('show'));
    line.classList.add('show');

    if(lines[i].showJesus){
      jesusWrap.style.display = 'block';
    } else {
      jesusWrap.style.display = 'none';
    }

    if(lines[i].sound) playSound(lines[i].sound);

    speak(lines[i].text, () => {
      setTimeout(() => {
        if(lines[i].final){
          revealFinale();
        } else {
          idx++;
          if(idx < lines.length) showLine(idx);
        }
      }, 650);
    });
  }

  function revealFinale(){
    overlay.style.transition = 'background .6s ease, opacity .6s ease';
    overlay.style.background = 'radial-gradient(circle at center, rgba(255,255,255,0.12) 0%, rgba(245,194,70,0.07) 20%, rgba(0,0,0,0.6) 70%)';
    overlay.style.opacity = '0.2';

    explosion.classList.add('show');
    explosion.style.pointerEvents = 'none';

    // confetti immediately
    try{
      const duration = 3000;
      const end = Date.now() + duration;
      (function frame(){
        confetti({ particleCount: 20, spread: 60, origin: { x: Math.random(), y: Math.random() * 0.6 } });
        if (Date.now() < end) { requestAnimationFrame(frame); }
      })();
    }catch(e){ console.warn('confetti failed', e); }

    document.querySelectorAll('.line').forEach(el => el.classList.remove('show'));
    document.getElementById('line-'+(lines.length-1)).classList.add('show');
  }

  function tryStart(){
    if (typeof speechSynthesis !== 'undefined') { speechSynthesis.onvoiceschanged = function(){}; }
    showLine(0);
  }

  window.addEventListener('load', () => {
    setTimeout(() => {
      try { tryStart(); } catch(e) { showStartOverlay(); }
    }, 300);
  });

  function showStartOverlay(){
    const btn = document.createElement('button');
    btn.textContent = 'Lancer la surprise ðŸŽ‰';
    btn.style.cssText = 'position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);padding:18px 28px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--accent),#ffdd6b);font-size:18px;font-weight:700;cursor:pointer;z-index:9999';
    document.body.appendChild(btn);
    btn.addEventListener('click', ()=>{
      btn.disabled = true; btn.style.opacity = '0.6';
      tryStart(); setTimeout(()=>btn.remove(), 700);
    });
  }

  document.addEventListener('keydown', (e) => {
    if(e.key === 'Enter' && (window.speechSynthesis && !window.speechSynthesis.speaking)){
      tryStart();
    }
  });

  </script>
</body>
</html>
