<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Surprise â€” Bon anniversaire Maman !</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#070607;
    --txt:#ffffff;
    --accent:#f5c246;
  }
  html,body{height:100%;margin:0;font-family: 'Roboto', Arial, sans-serif;background:var(--bg);color:var(--txt);} 
  .stage{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
    position:relative;
    overflow:hidden;
  }
  .panel{
    text-align:center;
    max-width:1100px;
    width:100%;
    padding:40px;
    position:relative; /* needed for positioning children */
  }
  .line{
    font-size: clamp(20px, 4.2vw, 48px);
    font-weight:700;
    color:var(--txt);
    margin:24px 0;
    opacity:0;
    transition:opacity .25s ease;
    text-shadow: 0 6px 22px rgba(0,0,0,0.6);
    font-family: 'Playfair Display', serif;
  }
  .line.show{ opacity:1; }
  .sub{
    font-weight:400;
    font-size: clamp(14px, 2vw, 18px);
    margin-top:8px;
  }
  /* image container */
  .img-wrap{
    position:relative;
    margin: 10px auto 6px auto;
    max-width:420px;
    width:100%;
    height:auto;
    display:none;
  }
  .img-wrap img{
    max-width:100%;
    height:auto;
    border-radius:8px;
    box-shadow:0 10px 40px rgba(0,0,0,0.6);
    display:block;
  }

  /* final reveal */
  .reveal-overlay{
    position:absolute;
    inset:0;
    background: radial-gradient(circle at center, rgba(255,255,255,0) 0%, rgba(0,0,0,0.6) 40%, rgba(0,0,0,0.9) 100%);
    pointer-events:none;
    transition:opacity .6s ease;
  }
  .explosion {
    position:absolute;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    pointer-events:none;
    opacity:0;
    transition:opacity .6s ease;
  }
  .explosion.show{ display:flex; opacity:1; }
  .final-images{
    display:flex;
    gap:20px;
    align-items:center;
    justify-content:center;
    transform:translateY(0);
  }
  .final-images img{ max-width:40vw; width:260px; border-radius:8px; box-shadow:0 14px 40px rgba(0,0,0,0.6); }

  /* small note */
  .note{ position:absolute; left:12px; bottom:10px; font-size:12px; color:rgba(255,255,255,0.25); }

  /* responsive */
  @media (max-width:720px){
    .final-images img{ width:42vw; max-width:180px; }
    .line{ margin:18px 0; }
  }
</style>
</head>
<body>
  <div class="stage" id="stage">
    <div class="panel" role="main" aria-live="polite">
      <div id="linesWrapper">
        <!-- Lines will be injected by JS -->
      </div>

      <!-- image for line 2 (jesus) -->
      <div class="img-wrap" id="jesusWrap" aria-hidden="true">
        <img id="jesusImg" src="https://cdn-useast1.kapwing.com/static/templates/buddy-christ-meme-template-thumbnail-b83659f8.webp" alt="Image spirituelle" loading="lazy" />
      </div>

      <!-- final explosion area -->
      <div class="explosion" id="explosion" aria-hidden="true">
        <div class="final-images" id="finalImages">
          <img id="knightImg" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT7UHe4EmUI1M73baN2mDOx-grtG4ORUvZqmA&s" alt="Image finale 1" loading="lazy" />
          <img id="eggImg" src="https://crack-the-egg.com/wp-content/uploads/oeuf_noir_600x600.jpg" alt="Image finale 2" loading="lazy" />
        </div>
      </div>

      <div class="note">Scannez, regardez et profitez ðŸŽ‰</div>
    </div>

    <div class="reveal-overlay" id="overlay"></div>
  </div>

  <!-- confetti lib -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

  <script>
  /*************************************************************
   * Texte et timing
   *************************************************************/
  const lines = [
    { text: "BON ANNIVERSAIRE MAMAN", sound: "https://www.soundjay.com/human/applause-8.mp3", showJesus:false, final:false },
    { text: "DÃ©jÃ  un demi siÃ¨cle que tu illumines cette Terre par ta prÃ©sence !!", sound: "https://www.soundjay.com/misc/sparkle-02.mp3", showJesus:true, final:false },
    { text: "Et pour te remercier de cela", sound: "https://www.soundjay.com/human/cheer-1.mp3", showJesus:false, final:false },
    { text: "Toute la famille s'est organisÃ©e pour t'offrir", sound: "https://www.soundjay.com/misc/drum-roll-01.mp3", showJesus:false, final:false },
    { text: "pour t'offrir...", sound: "https://www.soundjay.com/misc/drum-roll-02.mp3", showJesus:false, final:false },
    { text: "POUR T'OFFRIR........", sound: "https://www.soundjay.com/misc/drum-roll-03.mp3", showJesus:false, final:false },
    { text: "Je laisse durer encore un peu le suspens", sound: null, showJesus:false, final:false },
    { text: "UNE SORTIE ESCAPE GAME AVEC TOUTE LA FAMILLE ðŸ¥³ðŸ¥³ðŸ¥³", sound: "https://www.soundjay.com/human/applause-8.mp3", showJesus:false, final:true }
  ];

  // create DOM lines
  const wrapper = document.getElementById('linesWrapper');
  lines.forEach((l, idx) => {
    const div = document.createElement('div');
    div.className = 'line';
    div.id = 'line-'+idx;
    div.textContent = l.text;
    wrapper.appendChild(div);
  });

  // element refs
  const jesusWrap = document.getElementById('jesusWrap');
  const explosion = document.getElementById('explosion');
  const overlay = document.getElementById('overlay');

  /*************************************************************
   * Sounds (public, integrated)
   *************************************************************/
  function playSound(url){
    if(!url) return;
    try{
      const a = new Audio(url);
      a.volume = 0.9;
      a.play().catch(e => {
        // autoplay may be blocked â€” non fatal
        console.warn('Sound play blocked or failed', e);
      });
    }catch(e){ console.warn(e); }
  }

  /*************************************************************
   * Speech synthesis with a fallback timer (if blocked by browser)
   *************************************************************/
  function speak(text, onend){
    if(typeof onend !== 'function') onend = function(){};
    const u = new SpeechSynthesisUtterance(text);
    const voices = window.speechSynthesis ? window.speechSynthesis.getVoices() : [];
    const frVoices = voices.filter(v => /fr|french|fr-FR/i.test((v.lang || '') + ' ' + (v.name || '')));
    if(frVoices.length) u.voice = frVoices[0];
    u.rate = 0.95; u.pitch = 1.05; u.volume = 1.0;

    let ended = false;
    // fallback: if speech doesn't end within reasonable time, call onend so sequence continues
    const fallbackDelay = Math.max(1400, text.length * 60); // ms
    const fallback = setTimeout(() => {
      if(!ended){ ended = true; try{ window.speechSynthesis.cancel(); }catch(e){}; onend(); }
    }, fallbackDelay + 800);

    u.onend = () => {
      if(!ended){ ended = true; clearTimeout(fallback); onend(); }
    };

    try{
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(u);
    }catch(e){
      clearTimeout(fallback);
      console.warn('Speech synth failed', e);
      setTimeout(onend, 600);
    }
  }

  /*************************************************************
   * Main sequence (synchronised)
   *************************************************************/
  let idx = 0;
  function showLine(i){
    idx = i; // keep index in sync
    const line = document.getElementById('line-'+i);
    // hide all lines first
    document.querySelectorAll('.line').forEach(el => el.classList.remove('show'));
    // display this
    line.classList.add('show');

    // handle jesus image visibility and ensure it's visible on screen
    if(lines[i].showJesus){
      jesusWrap.style.display = 'block';
      jesusWrap.setAttribute('aria-hidden','false');
      // scroll the image (and text) into view so user doesn't have to
      try{ jesusWrap.scrollIntoView({behavior:'smooth', block:'center'}); }catch(e){}
    } else {
      jesusWrap.style.display = 'none';
      jesusWrap.setAttribute('aria-hidden','true');
    }

    // If this is the FINAL line, reveal images/confetti immediately (in sync with the voice)
    if(lines[i].final){
      revealFinale();
    }

    // play sound effect for this line
    if(lines[i].sound) playSound(lines[i].sound);

    // speak and then move to next when finished (unless final)
    speak(lines[i].text, () => {
      if(!lines[i].final){
        // small pause after speech for theatrical effect
        setTimeout(() => {
          idx++;
          if(idx < lines.length) showLine(idx);
        }, 650);
      } else {
        // final line ended â€” we keep the final state visible
      }
    });
  }

  /*************************************************************
   * Finale: explosion of colors, confetti, final sounds, show images
   * (This runs *when the final line is shown*, so it's in sync with the voice)
   *************************************************************/
  function revealFinale(){
    // show overlay tint
    overlay.style.transition = 'background .6s ease, opacity .6s ease';
    overlay.style.background = 'radial-gradient(circle at center, rgba(255,255,255,0.12) 0%, rgba(245,194,70,0.07) 20%, rgba(0,0,0,0.6) 70%)';
    overlay.style.opacity = '0.22';

    // show final images container
    explosion.classList.add('show');
    explosion.setAttribute('aria-hidden','false');

    // play celebratory layered sounds immediately
    try{
      playSound("https://www.soundjay.com/human/applause-8.mp3");
      setTimeout(()=> playSound("https://www.soundjay.com/human/cheer-1.mp3"), 300);
      setTimeout(()=> playSound("https://www.soundjay.com/human/cheer-2.mp3"), 600);
    }catch(e){ console.warn('play celebratory sounds failed', e); }

    // confetti bursts
    try{
      const duration = 3000;
      const end = Date.now() + duration;
      (function frame(){
        confetti({ particleCount: 20, spread: 70, origin: { x: Math.random(), y: Math.random() * 0.6 } });
        if (Date.now() < end) requestAnimationFrame(frame);
      })();
    }catch(e){ console.warn('confetti failed', e); }
  }

  /*************************************************************
   * Auto-start sequence with fallback to a user-gesture button
   *************************************************************/
  function tryStart(){
    // refresh voices list
    if (typeof speechSynthesis !== 'undefined') {
      speechSynthesis.onvoiceschanged = function(){};
    }
    showLine(0);
  }

  window.addEventListener('load', () => {
    setTimeout(() => {
      try{
        tryStart();
        // if speech didn't start (blocked), show a big "Tap to start" button
        setTimeout(() => {
          if (!window.speechSynthesis || window.speechSynthesis.speaking === false) {
            showStartOverlay();
          }
        }, 700);
      }catch(e){
        showStartOverlay();
      }
    }, 300);
  });

  /*************************************************************
   * Fallback start button for browsers that block autoplay
   *************************************************************/
  function showStartOverlay(){
    // avoid creating multiple buttons
    if(document.getElementById('startSurpriseBtn')) return;

    const btn = document.createElement('button');
    btn.id = 'startSurpriseBtn';
    btn.textContent = 'Lancer la surprise ðŸŽ‰';
    btn.style.cssText = 'position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);padding:18px 28px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--accent),#ffdd6b);font-size:18px;font-weight:700;cursor:pointer;z-index:9999';
    document.body.appendChild(btn);
    btn.addEventListener('click', ()=>{
      btn.disabled = true; btn.style.opacity = '0.6';
      tryStart(); setTimeout(()=>btn.remove(), 700);
    });
  }

  /*************************************************************
   * Accessibility: allow keyboard Enter to start if needed
   *************************************************************/
  document.addEventListener('keydown', (e) => {
    if(e.key === 'Enter' && (window.speechSynthesis && !window.speechSynthesis.speaking)){
      tryStart();
    }
  });

  </script>
</body>
</html>
